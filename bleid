# scan_ble_uuid.py
"""BLE ì¥ì¹˜ì˜ ëª¨ë“  ì„œë¹„ìŠ¤ì™€ UUIDë¥¼ ìŠ¤ìº”í•˜ëŠ” ìŠ¤í¬ë¦½íŠ¸"""
import asyncio
import bleak

async def scan_device():
    print("BLE ì¥ì¹˜ ìŠ¤ìº” ì¤‘...")
    devices = await bleak.BleakScanner.discover(timeout=10.0)
    
    target = None
    print("\n--- ê²€ìƒ‰ëœ ì¥ì¹˜ ---")
    for i, d in enumerate(devices):
        if d.name and "WT" in d.name:
            print(f"[{i+1}] {d.name} - {d.address}")
            target = d
    
    if not target:
        print("WT ì¥ì¹˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
        return
    
    print(f"\nì„ íƒëœ ì¥ì¹˜: {target.name} ({target.address})")
    print("ì—°ê²° ì¤‘...\n")
    
    async with bleak.BleakClient(target.address, timeout=15.0) as client:
        print("=" * 60)
        print(f"ì¥ì¹˜ëª…: {target.name}")
        print(f"ì£¼ì†Œ: {target.address}")
        print("=" * 60)
        
        for service in client.services:
            print(f"\nğŸ“¦ Service UUID: {service.uuid}")
            print(f"   ì„¤ëª…: {service.description}")
            
            for char in service.characteristics:
                properties = ", ".join(char.properties)
                print(f"   â””â”€ Characteristic UUID: {char.uuid}")
                print(f"      ì†ì„±: {properties}")
                
                # Notify ì†ì„±ì´ ìˆìœ¼ë©´ í‘œì‹œ
                if "notify" in char.properties:
                    print(f"      â­ READìš© UUID (Notify)")
                if "write" in char.properties or "write-without-response" in char.properties:
                    print(f"      âœï¸  WRITEìš© UUID")
        
        print("\n" + "=" * 60)
        print("ìŠ¤ìº” ì™„ë£Œ!")

if __name__ == "__main__":
    asyncio.run(scan_device())
